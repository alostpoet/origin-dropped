class t{_completed;_total;_el;constructor(t,e){this._el=document.getElementById(e||"progress"),this._total=t,this.completed=0}set completed(t){t=parseInt(t),this._completed=t,this.updateDom()}increase(){this.completed=this._completed+1}set total(t){this._total=parseInt(t),this.updateDom()}updateDom(){this._el.innerText=`${this._completed}/${this._total}`}reset(){this.completed=0}}window.OriginPoets=new class{_totalOrigins=1024;_startOrigin=1;_found=!1;_poetNumber=1;constructor(){this.progress=new t(this._totalOrigins)}reset(){this.found=!1,this.progress.reset()}async findByOsLink(){this.reset(),pageNav.to("retrievePoetPage");const t=document.getElementById("osLink").value.trim().split("/").pop();let e=await this.fetchOrigin(t);console.log("Retrieved poet",e);const i=this.getAttribute("Origin",e);return console.log("Got Origin",i),document.getElementById("originCode").value=i,this.start()}async start(){for(this.reset(),pageNav.to("noCachePage"),this._poetNumber=this._startOrigin,this._poetNumber;this._poetNumber<=this._totalOrigins;this._poetNumber++){let t;if(t=this.cached(this._poetNumber)?this.cached(`origin_${this._poetNumber}`):await this.fetchOrigin(this._poetNumber),void 0===t){this.found=!1;break}if(this.verify(t)){this.found=!0;break}}this.done()}done(){if(this._found){document.getElementById("dropped").innerHTML=`<a target="_blank" href="https://opensea.io/assets/0x4b3406a41399c7fd2ba65cbc93697ad9e7ea61e5/${this._poetNumber}">View on OpenSea</a>`}else this.found=!1;pageNav.to("results"),document.getElementById("originCode").value=""}get input(){return document.getElementById("originCode").value.trim().toUpperCase()}set found(t){t=!!t,this._found=t,this._found?document.getElementById("result").innerHTML=`<h1>Origin #${this.input} has been dropped already.</h1>`:document.getElementById("result").innerHTML=`<h1>Origin #${this.input} is still available!</h1>`}verify(t){return this.getAttribute("Origin",t)===this.input}getAttribute(t,e){let i=!1;return e.attributes.forEach((e=>{e?.trait_type===t&&(i=e.value)})),i}clear(){let t=1;for(;t<=this._totalOrigins;t++)this.clearCache(t);pageNav.to("startPage")}clearCache(t){t="string"==typeof t?t:"origin_"+t,localStorage.removeItem(t)}cached(t){t="string"==typeof t?t:"origin_"+t;try{return JSON.parse(localStorage.getItem(t))||!1}catch(t){return!1}}cache(t,e){t="string"==typeof t?t:"origin_"+t,localStorage.setItem(t,JSON.stringify(e))}async fetchOrigin(t){return await fetch(`https://lostpoets.api.manifoldxyz.dev/metadata/${t}`).then((t=>{if(!t.ok)throw Error(t.statusText);return t.json()})).then((e=>(this.cache(t,e),this.progress.increase(),e))).catch((e=>{console.log(`Origin ${t} not dropped yet?`)}))}},window.pageNav=new class{_pages;_currentPage;_previousPage;constructor(){this._pages=document.querySelectorAll(".page"),this.currentPage=this._pages[0]}to(t){this.currentPage=t}set currentPage(t){t="string"==typeof t?document.getElementById(t):t,this._currentPage&&(this._currentPage.classList.remove("show"),this._previousPage=this._currentPage),this._currentPage=t,this._currentPage.classList.add("show")}back(){this.currentPage=this._previousPage}get currentPage(){return this._currentPage}},window.clearCache=OriginPoets.clear;
